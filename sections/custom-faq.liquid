<style>
.main-faq-wrapper {
  width: 100%;
  margin-top: -11px;
}

/* --------------------------
   TABS BACKGROUND
--------------------------- */
.faq-tabs-wrapper {
  background-image: url({{ section.settings.tabs_bg_desktop | image_url }});
  background-size: 100% 100%;
  background-repeat: no-repeat;
  background-position: center;
  padding: 18px 0 35px;
}

@media(max-width:768px){
  .faq-tabs-wrapper {
    background-image: url({{ section.settings.tabs_bg_mobile | image_url }});
    padding: 35px 0;
  }
}

/* -------------------------
   MAIN CONTAINER
-------------------------- */
.faq-custom-container {
  max-width: 1990px;
  margin: 0 auto;
  padding: 0 210px;
}

/* -------------------------
   FAQ BACKGROUND (SAFE)
-------------------------- */
.faq-items-wrapper {
  position: relative;
  padding: 40px 0 100px;
  margin-top: -40px;
}

.faq-items-wrapper::before {
  content: "";
  position: absolute;
  inset: 0;
  background-image: url({{ section.settings.faq_bg_desktop | image_url }});
  background-size: cover;
  background-repeat: no-repeat;
  background-position: center;
  z-index: -1;
}

@media(max-width:768px){
  .faq-items-wrapper::before {
    background-image: url({{ section.settings.faq_bg_mobile | image_url }});
  }
}

/* -------------------------
   FILTER BY TEXT
-------------------------- */
.filter-title {
  color: #fff;
  font-weight: 700;
  font-size: 45px;
  line-height: 50px;
  font-family: var(--font-family);
  text-transform: lowercase;
}

/* -------------------------
   TABS STYLING
-------------------------- */
.faq-tabs {
  display: flex;
  align-items: center;
  gap: 71px;
  justify-content: center;
  color: #fff;
}

.tabs-grid {
  display: flex;
  flex-wrap: nowrap;
  gap: 71px;
  align-items: center;
  justify-content: center;
}

@media(max-width:768px){
  .tabs-grid { 
    flex-wrap: wrap;
    gap: 40px;
  }
  .faq-tabs { display: block; text-align: center; }
  .faq-custom-container { padding: 0 30px; }
}

/* TAB style */
.faq-tab {
    font-family: var(--font-family);
    position: relative;
    display: inline-block;
    padding-bottom: 5px;
    font-size: 45px; 
    line-height: 50px;
    color: #fff; 
    text-decoration: none;
    font-weight: 400;
    cursor: pointer;
    z-index: 0;
}

.faq-tab::after {
    content: '';
    position: absolute;
    left: 0;
    bottom: -40px;
    width: 0;
    height: 50px;
    background-image: url(https://cdn.shopify.com/s/files/1/0577/3957/5488/files/Vector_19_2.png?v=1765171177);
    background-size: contain;
    background-repeat: no-repeat;
    transition: width 0.4s ease;
    z-index: -1;
}

.faq-tab.active {
  color: #F89821 !important;
}

.faq-tab.active::after {
    width: 100%;
}

/* DISABLED TAB STYLE - When no FAQs in section */
.faq-tab.disabled {
    color: #999 !important;
    opacity: 0.5;
    cursor: not-allowed;
    pointer-events: none;
}

.faq-tab.disabled::after {
    display: none;
}

/* -------------------------
   DYNAMIC TITLE ABOVE FAQ
-------------------------- */
.faq-dynamic-title {
  font-family: var(--font-family);
  font-size: 60px;
  line-height: 50px;
  font-weight: 700;
  color: #0F4735;
  margin: 50px 0;
  text-transform: lowercase;
}

/* -------------------------
   FAQ SECTION
-------------------------- */
.faq-section { display: block; }
.faq-section.hidden { display: none; }

/* -------------------------
   SECTION TITLE (BEFORE EACH SECTION'S FAQs)
-------------------------- */
.section-title {
  font-family: var(--font-family);
  font-size: 60px;
  line-height: 50px;
  font-weight: 700;
  color: #0F4735;
  margin: 50px 0 30px;
  text-transform: lowercase;
}

.section-title.hidden { display: none; }

/* -------------------------
   FAQ ITEM - CONTENT IN SAME CONTAINER, OVERLAPS BELOW
-------------------------- */
.faq-item {
  background: #F1EAD9;
  border-radius: 10px;
  margin-bottom: 24px;
  padding: 17px 22px;
  border: 4px solid #0F4735;
  position: relative;
  z-index: 1;
  transition: z-index 0.3s ease, margin-bottom 0.5s cubic-bezier(0.4, 0, 0.2, 1);
}

.faq-item.open {
  z-index: 10;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
  /* Negative margin calculated dynamically via JavaScript */
}

.faq-item-title {
  display: flex;
  justify-content: space-between;
  align-items: center;
  font-weight: 500;
  font-size: 40px;
  font-family: var(--font-family);
  color: #0F4735;
  line-height: 50px;
}

/* ARROW */
.faq-arrow {
  display: flex;
  justify-content: center;
  align-items: center;
  border-radius: 50%;
  min-width: 52px;
  width: 52px;
  height: 52px;
  border: 3px solid #0F4735;
  background: #F89821;
  transition: 0.3s ease;
  cursor: pointer;
  flex-shrink: 0;
}

.faq-item.open .faq-arrow {
  transform: rotate(180deg);
  background: #95C940;
}

.faq-item-title .faq-arrow svg {
  width: 26px !important;
  height: auto !important;
  display: block;
  margin-top: 5px;
}

/* FAQ CONTENT - INSIDE SAME CONTAINER */
.faq-item-content {
  max-height: 0;
  overflow: hidden;
  transition: max-height 0.5s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.4s ease, padding 0.4s ease;
  opacity: 0;
  padding-top: 0;
}

.faq-item.open .faq-item-content {
  max-height: 1000px;
  opacity: 1;
  padding-top: 15px;
}

.faq-item-content p {
   margin: 0; 
   font-size: 24px;
   font-family: var(--font-family);
   line-height: 33px;
   color: #5D3328;
}

  @media(min-width:1301px) and (max-width:1483px){
    .faq-custom-container {
      padding: 0 120px !important;
    }
}
@media (max-width: 1600px) {
    .filter-title, .faq-tab {
      font-size: 34px;
      line-height: 38px;
    }
    .faq-dynamic-title {
      font-size: 45px;
      line-height: 38px;
      margin: 35px 0;
    }
    .section-title {
      font-size: 45px;
      line-height: 38px;
      margin: 35px 0 25px;
    }
    .faq-item-title {
      font-size: 30px;
      line-height: 38px;
    }
    .faq-item-content p {
      font-size: 18px;
      line-height: 25px;
    }
  }

  @media (max-width: 1200px) {
    .faq-custom-container {
      padding: 0 130px;
    }
    .filter-title, .faq-tab {
      font-size: 32px;
      line-height: 36px;
    }
    .tabs-grid {
      gap: 50px;
    }
    .faq-dynamic-title {
      font-size: 42px;
      line-height: 38px;
      margin: 35px 0;
    }
    .section-title {
      font-size: 42px;
      line-height: 38px;
      margin: 35px 0 25px;
    }
    .faq-item-title {
      font-size: 28px;
      line-height: 34px;
    }
    .faq-item-content p {
      font-size: 18px;
      line-height: 25px;
    }
  }

  @media (max-width: 992px) {
    .faq-custom-container {
      padding: 0 110px;
    }
    .filter-title, .faq-tab {
      font-size: 30px;
      line-height: 34px;
    }
    .tabs-grid {
      gap: 40px;
    }
    .faq-dynamic-title {
      font-size: 40px;
      line-height: 38px;
      margin: 36px 0;
    }
    .section-title {
      font-size: 40px;
      line-height: 38px;
      margin: 36px 0 25px;
    }
    .faq-item-title {
      font-size: 26px;
      line-height: 30px;
    }
    .faq-item-content p {
      font-size: 16px;
      line-height: 22px;
    }
  }

 @media (max-width: 768px) and (min-width: 460px) {
  .faq-tab {
    padding-bottom: 0;
    }
    .faq-tab::after {
        height: 30px;
        bottom: -25px;
        background-size: auto;
        background-position: center;
    }

}

@media(max-width:768px){
    .tabs-grid {
        grid-template-columns: repeat(2, auto);
        gap: 40px;
        margin: 20px 0;
    }
  .faq-tabs {
    display: block;
    text-align: center;
  }
  .faq-tab, .filter-title { 
    font-size: 33px;
    line-height: 36px 
  }
  .faq-custom-container {
    padding: 0 30px;
  }
  .faq-item {
    padding: 10px 22px;
  }
  .faq-item-title {
    font-size: 20px;
    line-height: 24px;
  }
  .faq-item.open .faq-item-content p {
    font-size: 16px;
    line-height: 22px;
}

    .faq-dynamic-title {
      font-size: 38px;
      line-height: 50px;
      margin: 16px 0 20px;
    }
    .section-title {
      font-size: 38px;
      line-height: 50px;
      margin: 16px 0 20px;
    }
}

@media(max-width: 576px){
  .faq-tab, .filter-title { 
    font-size: 30px;
    line-height: 30px 
  }
  .faq-dynamic-title {
    font-size: 34px;
    line-height: 40px;
    margin: 16px 0 20px;
  }
  .section-title {
    font-size: 34px;
    line-height: 40px;
    margin: 16px 0 20px;
  }

  .faq-item-title {
    font-size: 18px;
    line-height: 22px;
  }
  .faq-item.open .faq-item-content p {
    font-size: 14px;
    line-height: 20px;
}

}

@media (max-width: 380px) {
  .filter-title {
      font-size: 30px;
  }
  .faq-tab{
    font-size: 30px;
    line-height: 30px;
  }
  .tabs-grid {
    margin-top: 10px;
    gap: 20px;
  }
  .faq-custom-container {
    padding: 0 15px;
  }
  .faq-item {
    padding: 17px 10px;
  }
  .faq-item-title {
    font-size: 16px;
    line-height: 22px;
  }
  .faq-item.open .faq-item-content p {
    font-size: 14px;
    line-height: 20px;
  }

  .faq-arrow {
    min-width: 36px;
    width: 36px;
    height: 36px;
  }

  .faq-item-title .faq-arrow svg {
    width: 20px !important;
  }
}

</style>


<!-- MAIN WRAPPER -->
<div class="main-faq-wrapper">

  <!-- TABS BACKGROUND -->
  <div class="faq-tabs-wrapper">
    <div class="faq-custom-container">

      <div class="faq-tabs">
        
        <span class="filter-title">filter by:</span>

        <div class="tabs-grid">
          {% for block in section.blocks %}
            {% if block.type == 'tab' %}
            <div class="faq-tab" data-tab="{{ block.settings.tab_id }}">
              {{ block.settings.tab_title }}
            </div>
            {% endif %}
          {% endfor %}
        </div>

      </div>

    </div>
  </div>


  <!-- FAQ BACKGROUND + ITEMS -->
  <div class="faq-items-wrapper">
    <div class="faq-custom-container">

      <!-- â­ DYNAMIC TITLE -->

      {% for tab in section.blocks %}
        {% if tab.type == 'tab' %}
        <!-- Section Title -->
        <h3 class="section-title" id="title-{{ tab.settings.tab_id }}" data-tab-id="{{ tab.settings.tab_id }}">
          {{ tab.settings.tab_title }}
        </h3>

        <!-- Section FAQs -->
        <div class="faq-section" id="section-{{ tab.settings.tab_id }}">

          {% for faq in section.blocks %}
            {% if faq.type == 'faq' and faq.settings.parent_tab == tab.settings.tab_id %}
            <div class="faq-item">

              <div class="faq-item-title">
                <span>{{ faq.settings.faq_question }}</span>

                <span class="faq-arrow">
                  <svg xmlns="http://www.w3.org/2000/svg" width="33" height="19" viewBox="0 0 33 19" fill="none">
                    <path d="M1.36328 1.46094L16.3633 15.4609L31.3633 1.46094" stroke="#0F4735" stroke-width="4"/>
                  </svg>
                </span>
              </div>

              <div class="faq-item-content">
                <p>{{ faq.settings.faq_answer }}</p>
              </div>

            </div>
            {% endif %}
          {% endfor %}

        </div>
        {% endif %}
      {% endfor %}

    </div>
  </div>

</div>


<script>
document.addEventListener("DOMContentLoaded", () => {

  const tabs = document.querySelectorAll(".faq-tab");
  const sections = document.querySelectorAll(".faq-section");

  /* CHECK AND DISABLE TABS WITH NO FAQs */
  function checkAndDisableEmptyTabs() {
    tabs.forEach(tab => {
      const tabId = tab.dataset.tab;
      const section = document.getElementById("section-" + tabId);
      
      if (section) {
        const faqItems = section.querySelectorAll(".faq-item");
        
        // If no FAQs found, disable the tab
        if (faqItems.length === 0) {
          tab.classList.add("disabled");
        } else {
          tab.classList.remove("disabled");
        }
      } else {
        // If section doesn't exist, disable the tab
        tab.classList.add("disabled");
      }
    });
  }

  /* FUNCTION TO UPDATE VISIBLE SECTIONS AND TITLE */
  function updateVisibleSections() {
    const activeTabs = Array.from(tabs).filter(tab => tab.classList.contains("active"));
    const sectionTitles = document.querySelectorAll(".section-title");
    
    // Show/hide sections and their titles based on active tabs
    sections.forEach(section => {
      const sectionId = section.id.replace("section-", "");
      const correspondingTab = Array.from(tabs).find(tab => tab.dataset.tab === sectionId);
      const sectionTitle = document.getElementById("title-" + sectionId);
      const faqItems = section.querySelectorAll(".faq-item");
      const hasFAQs = faqItems.length > 0;
      
      if (activeTabs.length === 0) {
        // If no tabs are active, show all sections and titles (only if they have FAQs)
        if (hasFAQs) {
          section.classList.remove("hidden");
          if (sectionTitle) sectionTitle.classList.remove("hidden");
        } else {
          section.classList.add("hidden");
          if (sectionTitle) sectionTitle.classList.add("hidden");
        }
      } else {
        // Show section and title only if its corresponding tab is active AND has FAQs
        if (correspondingTab && correspondingTab.classList.contains("active")) {
          if (hasFAQs) {
            section.classList.remove("hidden");
            if (sectionTitle) sectionTitle.classList.remove("hidden");
          } else {
            // Even if tab is active, hide if no FAQs
            section.classList.add("hidden");
            if (sectionTitle) sectionTitle.classList.add("hidden");
          }
        } else {
          section.classList.add("hidden");
          if (sectionTitle) sectionTitle.classList.add("hidden");
        }
      }
    });

    // Note: Dynamic title removed, using section titles instead
  }

  /* TAB TOGGLE - Allow multiple tabs to be active */
  tabs.forEach(tab => {
    tab.addEventListener("click", () => {
      // Don't allow clicking disabled tabs
      if (tab.classList.contains("disabled")) {
        return;
      }
      
      // Toggle active state
      tab.classList.toggle("active");
      
      // Update visible sections and title
      updateVisibleSections();
    });
  });

  // Check for empty tabs and disable them
  checkAndDisableEmptyTabs();

  // Initialize - show all sections by default
  updateVisibleSections();

  /* FAQ ACCORDION - Only arrow button is clickable */
  document.querySelectorAll(".faq-arrow").forEach(arrow => {
    arrow.addEventListener("click", (e) => {
      e.stopPropagation(); // Prevent event bubbling
      const item = arrow.closest(".faq-item");
        if (item) {
          const isOpening = !item.classList.contains("open");
          item.classList.toggle("open");
        }
    });
  });

});
</script>



{% schema %}
{
  "name": "Dynamic FAQ Tabs Section",

  "settings": [
    { "type": "image_picker", "id": "tabs_bg_desktop", "label": "Tabs Background Desktop" },
    { "type": "image_picker", "id": "tabs_bg_mobile", "label": "Tabs Background Mobile" },
    { "type": "image_picker", "id": "faq_bg_desktop", "label": "FAQ Background Desktop" },
    { "type": "image_picker", "id": "faq_bg_mobile", "label": "FAQ Background Mobile" }
  ],

  "blocks": [
    {
      "type": "tab",
      "name": "Tab",
      "settings": [
        { "type": "text", "id": "tab_title", "label": "Tab Title" },
        { "type": "text", "id": "tab_id", "label": "Tab Unique ID" }
      ]
    },
    {
      "type": "faq",
      "name": "FAQ Item",
      "settings": [
        { "type": "text", "id": "parent_tab", "label": "Parent Tab ID" },
        { "type": "text", "id": "faq_question", "label": "FAQ Question" },
        { "type": "richtext", "id": "faq_answer", "label": "FAQ Answer" }
      ]
    }
  ],

  "presets": [
    { "name": "Dynamic FAQ Tabs" }
  ]
}
{% endschema %}

