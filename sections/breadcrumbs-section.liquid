{% comment %}
  Breadcrumbs Section with LocalStorage Collection Tracking
{% endcomment %}

<section id="kf-breadcrumbs" class="kf-breadcrumbs-wrapper color-{{ section.settings.color_scheme }}">
  <nav class="kf-breadcrumbs" aria-label="Breadcrumb">
    <ul id="breadcrumb-list">

      <li><a href="{{ routes.root_url }}">Home</a></li>

      {%- comment -%}
        Default Liquid Breadcrumb (used only if localStorage has nothing)
      {%- endcomment -%}

      {% if template contains 'collection' %}
        <li class="liquid-collection">{{ collection.title }}</li>
      {% endif %}

      {% if product %}
        <li class="liquid-product">{{ product.title }}</li>
      {% endif %}

      {% if page %}
        <li class="liquid-page">{{ page.title }}</li>
      {% endif %}

    </ul>
  </nav>
</section>

<style>
.kf-breadcrumbs-wrapper {
  padding: 38px 180px 0px 180px;
  max-width: 1990px;
  margin: 0 auto;
}

.kf-breadcrumbs ul {
  list-style: none;
  padding: 0;
  margin: 0;
  display: flex;
  gap: 6px;
  font-family: var(--font-family);
  font-weight: 400;
  font-size: 22px;
  line-height: 100%;
  color: #39302D;
  flex-wrap: wrap;
}

.kf-breadcrumbs li::after {
  content: ">";
  margin-left: 6px;
  color: #777;
}

.kf-breadcrumbs li:last-child::after {
  content: "";
}

.kf-breadcrumbs li:last-child {
  font-weight: 700;
}

@media screen and (max-width: 768px) {
  .kf-breadcrumbs-wrapper {
    padding: 38px 30px 0;
  }
}
</style>

<script>
document.addEventListener("DOMContentLoaded", function () {

  // -----------------------------
  // 1️⃣ SAVE COLLECTION WHEN ON COLLECTION PAGE
  // -----------------------------
  {% if collection %}
    localStorage.setItem("last_collection_title", "{{ collection.title | escape }}");
    localStorage.setItem("last_collection_url", "{{ collection.url }}");
  {% endif %}

  // -----------------------------
  // 2️⃣ USE SAVED COLLECTION ON PRODUCT PAGE
  // -----------------------------
  {% if product %}
    const savedTitle = localStorage.getItem("last_collection_title");
    const savedURL = localStorage.getItem("last_collection_url");

    if (savedTitle && savedURL) {

      // Remove default Liquid breadcrumb for collection
      const liquidCollection = document.querySelector(".liquid-collection");
      if (liquidCollection) liquidCollection.remove();

      // Insert Saved Collection Before Product Name
      const li = document.createElement("li");
      li.innerHTML = `<a href="${savedURL}">${savedTitle}</a>`;

      const breadcrumbList = document.getElementById("breadcrumb-list");
      const productItem = document.querySelector(".liquid-product");

      if (breadcrumbList && productItem) {
        breadcrumbList.insertBefore(li, productItem);
      }
    }
  {% endif %}

});
</script>

{% schema %}
{
  "name": "Breadcrumbs",
  "tag": "section",
  "settings": [
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "Color Scheme",
      "default": "background-1"
    }
  ],
  "presets": [
    {
      "name": "Breadcrumbs Section"
    }
  ]
}
{% endschema %}
